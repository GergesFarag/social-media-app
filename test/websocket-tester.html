<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Tester</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { max-width: 900px; margin: 0 auto; padding: 20px; background: #1a1a2e; color: #eee; }
    h1 { color: #00d4ff; }
    .section { background: #16213e; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
    .section h3 { margin-top: 0; color: #00d4ff; border-bottom: 1px solid #0f3460; padding-bottom: 10px; }
    input, button { padding: 10px; border-radius: 5px; border: none; margin: 5px 0; }
    input { background: #0f3460; color: #fff; width: 100%; }
    button { background: #00d4ff; color: #1a1a2e; cursor: pointer; font-weight: bold; }
    button:hover { background: #00a8cc; }
    button.danger { background: #e94560; }
    button.danger:hover { background: #c73e54; }
    .status { padding: 8px 15px; border-radius: 20px; display: inline-block; margin: 10px 0; }
    .status.connected { background: #00ff88; color: #000; }
    .status.disconnected { background: #e94560; color: #fff; }
    #logs { background: #0f0f23; padding: 15px; border-radius: 8px; height: 300px; overflow-y: auto; font-family: monospace; font-size: 13px; }
    .log { margin: 5px 0; padding: 5px; border-radius: 3px; }
    .log.info { background: #1e3a5f; }
    .log.success { background: #0d4d0d; }
    .log.error { background: #4d0d0d; }
    .log.message { background: #3d1a5f; }
    .log .time { color: #888; margin-right: 10px; }
    .row { display: flex; gap: 10px; }
    .row input { flex: 1; }
    .row button { flex-shrink: 0; }
  </style>
</head>
<body>
  <h1>ðŸ”Œ WebSocket Tester</h1>
  
  <!-- Connection Section -->
  <div class="section">
    <h3>1. Connection</h3>
    <input type="text" id="serverUrl" value="http://localhost:3000" placeholder="Server URL">
    <div class="row">
      <button onclick="connect()">Connect</button>
      <button onclick="disconnect()" class="danger">Disconnect</button>
    </div>
    <div id="connectionStatus" class="status disconnected">Disconnected</div>
  </div>

  <!-- Join Room Section -->
  <div class="section">
    <h3>2. Join Conversation</h3>
    <div class="row">
      <input type="text" id="conversationId" placeholder="Conversation ID (e.g., 69595230d47b39c3a9db4d7f)">
      <button onclick="joinConversation()">Join</button>
      <button onclick="leaveConversation()" class="danger">Leave</button>
    </div>
  </div>

  <!-- Typing Section -->
  <div class="section">
    <h3>3. Typing Indicator</h3>
    <div class="row">
      <input type="text" id="userId" placeholder="Your User ID">
      <button onclick="sendTyping(true)">Start Typing</button>
      <button onclick="sendTyping(false)" class="danger">Stop Typing</button>
    </div>
  </div>

  <!-- Logs Section -->
  <div class="section">
    <h3>ðŸ“‹ Event Logs</h3>
    <button onclick="clearLogs()" class="danger" style="margin-bottom: 10px;">Clear Logs</button>
    <div id="logs"></div>
  </div>

  <script>
    let socket = null;

    function log(message, type = 'info') {
      const logs = document.getElementById('logs');
      const time = new Date().toLocaleTimeString();
      const div = document.createElement('div');
      div.className = `log ${type}`;
      div.innerHTML = `<span class="time">[${time}]</span> ${message}`;
      logs.appendChild(div);
      logs.scrollTop = logs.scrollHeight;
    }

    function clearLogs() {
      document.getElementById('logs').innerHTML = '';
    }

    function updateStatus(connected) {
      const status = document.getElementById('connectionStatus');
      status.className = `status ${connected ? 'connected' : 'disconnected'}`;
      status.textContent = connected ? `Connected (ID: ${socket?.id})` : 'Disconnected';
    }

    function connect() {
      const url = document.getElementById('serverUrl').value;
      
      if (socket?.connected) {
        log('Already connected!', 'error');
        return;
      }

      log(`Connecting to ${url}...`);
      
      socket = io(url, {
        transports: ['websocket', 'polling'],
      });

      // Connection events
      socket.on('connect', () => {
        log(`âœ… Connected with ID: ${socket.id}`, 'success');
        updateStatus(true);
      });

      socket.on('disconnect', (reason) => {
        log(`âŒ Disconnected: ${reason}`, 'error');
        updateStatus(false);
      });

      socket.on('connect_error', (error) => {
        log(`âŒ Connection Error: ${error.message}`, 'error');
        updateStatus(false);
      });

      // App events
      socket.on('newMessage', (message) => {
        log(`ðŸ“© NEW MESSAGE: ${JSON.stringify(message, null, 2)}`, 'message');
      });

      socket.on('userTyping', (data) => {
        log(`âŒ¨ï¸ User ${data.userId} is ${data.isTyping ? 'typing...' : 'stopped typing'}`, 'info');
      });
    }

    function disconnect() {
      if (socket) {
        socket.disconnect();
        log('Disconnected manually', 'info');
        updateStatus(false);
      }
    }

    function joinConversation() {
      const conversationId = document.getElementById('conversationId').value;
      if (!conversationId) {
        log('Please enter a conversation ID', 'error');
        return;
      }
      if (!socket?.connected) {
        log('Not connected! Connect first.', 'error');
        return;
      }

      log(`Joining conversation: ${conversationId}...`);
      socket.emit('joinConversation', { conversationId }, (response) => {
        log(`ðŸ“¥ Join response: ${JSON.stringify(response)}`, 'success');
      });
    }

    function leaveConversation() {
      const conversationId = document.getElementById('conversationId').value;
      if (!conversationId) {
        log('Please enter a conversation ID', 'error');
        return;
      }
      if (!socket?.connected) {
        log('Not connected!', 'error');
        return;
      }

      log(`Leaving conversation: ${conversationId}...`);
      socket.emit('leaveConversation', { conversationId }, (response) => {
        log(`ðŸ“¤ Leave response: ${JSON.stringify(response)}`, 'info');
      });
    }

    function sendTyping(isTyping) {
      const conversationId = document.getElementById('conversationId').value;
      const userId = document.getElementById('userId').value;
      
      if (!conversationId || !userId) {
        log('Please enter conversation ID and user ID', 'error');
        return;
      }
      if (!socket?.connected) {
        log('Not connected!', 'error');
        return;
      }

      socket.emit('typing', { conversationId, userId, isTyping });
      log(`Sent typing: ${isTyping}`, 'info');
    }

    // Auto-connect on page load (optional)
    // window.onload = connect;
  </script>
</body>
</html>
